<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN">

<!-- simple jekyll search -->
<script src="//cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.11/dest/simple-jekyll-search.min.js"></script>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <meta name="google-site-verification" content="GtBOHqwkUyIwJzqdPZ1VheMXW4edMcCJwjFJx5kGdWo" />
    <meta name="google-site-verification" content="41OWG5Vo9v4bjss_dr9CXfFGqd6FOE6iz-amoUsSC4U" />  <!-- Submit github.io to g. -->
    <meta name="baidu-site-verification" content="yML3Kpovuo" />
    <meta name="360-site-verification" content="49ed3d11f562a12a5ba68d3c6d2115b0" />
    <meta name="sogou_site_verification" content="53WDIeIDAM" /> <!-- Submit github.io to sg. -->
    <meta name="msvalidate.01" content="0FE0D36F099AFBB1CAC652EF20A2437F" />

    <title> 基于托管的C++来使用WPF - Using WPF with Managed C++_极客玩家大白</title>
    <meta name="keywords" content="Python, 大白, VR, 大奔SEO, 大白SEO, 大白技术控, LeetCode, .NET, WPF, "C#", .NET Core, PHP, geekplayer, geekplayers, 极客玩家, RSS, k8s, 生活故事, 一线, 开发者, 编程, 代码, 开源, IT网站,Developer, Programmer, Coder, Geek, IT技术博客">
    <meta name="description"
          content="基于托管的C++来使用WPF - Using WPF with Managed C++">

    <link rel="canonical" href="http://localhost:4000/Using-WPF-with-Managed-cpp.html">
    <link rel="alternate" type="application/rss+xml" title="极客玩家大白" href="http://localhost:4000/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="//geekplayers.com/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="//geekplayers.com/assets/css/syntax.css">
    <link rel="stylesheet" href="//geekplayers.com/assets/css/sidebar-post-nav.css">

    <!-- My CSS -->
    <link rel="stylesheet" href="//geekplayers.com/assets/css/common.css">

    <!-- CSS set in page -->
    
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/css/index.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/css/sidebar-popular-repo.css"> -->

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/css/sidebar-post-nav.css">
    

    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@v4.6.3/css/font-awesome.min.css">

    <script type="text/javascript" src="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</head>


    <body>

    <script>
        (function () {
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

    <!-- baidu analyisis -->
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?87596be0014a64eee1571944c5130a8e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176595919-1">
    </script>
    
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-176595919-1');
    </script>
    
    <script>
        (function () {
            var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
            document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/python.html"
                       target="_self"
                       title="Python">
                        Python
                    </a>
                </div>
                
                <div class="item">
                    <a href="/it.html"
                       target="_self"
                       title="IT">
                        IT
                    </a>
                </div>
                
                <div class="item">
                    <a href="/zsxq.html"
                       target="_self"
                       title="星球">
                        星球
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="故事">
                        故事
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大白技术控">
            <span class="octicon octicon-gist-secret"></span>
            大白技术控
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/algo.html"
                   target="_self"
                   title="算法">
                    算法
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/dabenSeo.html"
                   target="_blank"
                   title="大奔SEO">
                    大奔SEO
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/dabaiSEO.html" 
                           target="_blank"
                     >大白SEO</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/dotnet.html"
                   target="_blank"
                   title=".NET">
                    .NET
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/csharp.html" 
                           target=""
                     >C#</a></li>
                    
                    <li><a href="/wpf.html" 
                           target=""
                     >WPF</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/k8s.html"
                   target="_self"
                   title="k8s">
                    k8s
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/k8s.html" 
                           target=""
                     >k8s</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/archives.html"
                   target="_self"
                   title="Archives">
                    Archives
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/tools/"
                   target="_blank"
                   title="Tools">
                    Tools
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/run-liquild-online.html" 
                           target=""
                     >Run Liquid now</a></li>
                    
                    <li><a href="/run-liquild-online-pro.html" 
                           target=""
                     >Run Liquid now Pro</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/about.html"
                   target="_self"
                   title="About">
                    About
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="基于托管的C++来使用WPF - Using WPF with Managed C++">
    <div class="container">
        <div id="jumbotron-meta-info">
            <!-- <h1>基于托管的C++来使用WPF - Using WPF with Managed C++</h1> -->
            <h1 style="font-size: 45px;">
                <a class="hvr-underline-from-center" style="display: initial !important;" href="/Using-WPF-with-Managed-cpp.html" title="基于托管的C++来使用WPF - Using WPF with Managed C++_极客玩家大白" target="_self" rel="canonical">基于托管的C++来使用WPF - Using WPF with Managed C++</a>
            </h1>

            <span class="meta-info">
                

                
                
                    <i class="fa fa-user" aria-hidden="true"></i> <a href='http://localhost:4000'>Bravo Yeung</a>
                

                
                                
                
                <span class="octicon octicon-calendar"></span> <font style="color: #ddd;">2020/06/27 00:00:00</font>
                
            </span>
            
            <p>
                
                
                
                
                    
                    <font style="color: #ddd;"><i class="fa fa-folder-open" aria-hidden="true"></i></font>
                    
                        <a style='background-color: #16a085 !important; padding: 2px 6px; border-radius: 4px !important;font-size: 15px;overflow: scroll;' 
                        href="/categories/#WPF">WPF</a>
                    
                        <a style='background-color: #16a085 !important; padding: 2px 6px; border-radius: 4px !important;font-size: 15px;overflow: scroll;' 
                        href="/categories/#C++">C++</a>
                    
                                    
                
                <!-- <p>out index:1</p>
                <p>size: 2</p> -->
                
                
                                    
                
                <!-- <p>out index:2</p>
                <p>size: 14</p> -->
                
                
                                    
                
                <!-- <p>out index:3</p>
                <p>size: 3</p> -->
                
                
                                    
                
                <!-- <p>out index:4</p>
                <p>size: 3</p> -->
                            
            </p>

        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h1 id="基于托管的c来使用wpf---using-wpf-with-managed-c">基于托管的C++来使用WPF - Using WPF with Managed C++</h1>

<p>Posted by <strong>Zeeshan Amjad</strong></p>

<p>This article was originally published on <code class="language-plaintext highlighter-rouge">August 12th, 2009</code></p>

<h2 id="1-introduction">1. Introduction</h2>

<p>The purpose of this article is two folds. At the first half we discuss what WPF is. In addition we studied why and how to program WPF using Managed C++ and high level overview of WPF architecture. Latter we scratch the surface of Loan Amortization with one working example of Loan Amortization in WPF using C++.</p>

<h2 id="2-what-is-wpf">2. What is WPF?</h2>

<p>Before going to study the WPF one might ask a question that what is WPF? WPF is abbreviation of “Window Presentation Foundation”. It is a next generation presentation system for building window client application that can be run stand alone as well as in a Web Browser (i.e. XBAP Application). WPF is based on .Net environment, it means it is a managed code and theoretically can be written with any .Net based language such as Visual C#, VB.Net and Managed C++. WPF introduced with .Net 3.0 with few other important technologies such as Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF), but here we are going to study only WPF.</p>

<p>WPF is the latest Microsoft technologies to create user interface. It was introduced with .Net 3.0 and then improved in .Net 3.5 and .Net 4.0 (Beta as of now). It does not depend on Windows Standard control; it draws everything from DirectX technology and takes full advantage of 3D graphics and hardware accelerator if available.</p>

<p>Most of the programmer thought that WPF is a feature of Visual C# and VB.Net can be done only in these languages. Although writing WPF programs in these languages are quite easy and fun, but it is not limited to only this. WPF is in fact a feature of .Net introduced with its version 3.5; therefore technically any .Net language can use it.</p>

<p>If this is a case then why there are so many WPF samples written only in C# and VB.Net codes even in MSDN? The best answer might be because of XAML. When using C# or VB.Net then we can take full advantage of XAML, which is not available in VC++.Net. It means when you are trying to write WPF code in Managed C++, then you are on your own and have to write code for everything. It may be a daunting task but not impossible and in fact there are few samples available with Microsoft SDK such as PlotPanel, RadialPanel, CustomPanel etc.</p>

<h3 id="21-why-managed-c-for-wpf">2.1. Why Managed C++ for WPF?</h3>

<p>Next question is why should we use Managed C++ in Visual C++ to write WPF application when we can do the same thing in C# or VB.Net with XAML? There can be different reasons for it.</p>

<ul>
  <li>You lots of code base written in VC++ unmanaged code and it is not possible to rewrite everything in C#. You want to take advantage of both managed and unmanaged code in your project, such as using MFC document view architecture with rich user interface of WPF without creating any new DLL in C#.</li>
  <li>Portion of your programs should be optimized for speed and for performance reason you write unmanaged code for it. WPF internally used the same technique for performance reason to call DirectX.</li>
  <li>You want to hide the implementation of some portion of your program and or algorithm so no one can reverse engineer and write it as unmanaged code so no one can reverse engineer your code using ildasm.</li>
  <li>Just for fun.</li>
</ul>

<h3 id="22-wpf-programming-in-vc">2.2. WPF Programming in VC++</h3>

<p>To create simplest WPF program using Managed C++, you have to include reference of .Net components named windowsbase.dll, presentationcore.dll and presentationframeworkd.dll. In addition the program must be compiled using /clr switch because it is a managed code. Here is a diagram to show one project that has added references of these three DLL. To add the reference, right click on the project in the Solution Explorer tree and select “Reference…” from there.</p>

<p><img src="https://www.codeguru.com/images/article/16355/loan_01.gif" alt="img" /></p>

<p>If we want to create a simple windows based program then it would be something like this.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="cp">#include &lt;windows.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="o">::</span><span class="n">Windows</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="n">WINAPI</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span>
				   <span class="n">LPSTR</span> <span class="n">lpCmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">MessageBox</span><span class="o">::</span><span class="n">Show</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This program does nothing more than simply display one message box. We can further shorten the program by using main instead of WinMain and avoid including windows.h header file altogether, but in that case we will see the black console window behind the message box.</p>

<p>If we want to make something more useful and interesting then we have to create objects of at least two classes Window and Application. But remember there can be only one object of Application class in the whole program. Here is the simplest program to show the usage of Window and Application class.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="cp">#include &lt;windows.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="o">::</span><span class="n">Windows</span><span class="p">;</span>
 
<span class="p">[</span><span class="n">STAThread</span><span class="p">]</span>
<span class="kt">int</span> <span class="n">WINAPI</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span>
				   <span class="n">LPSTR</span> <span class="n">lpCmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Window</span><span class="o">^</span> <span class="n">win</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">Window</span><span class="p">();</span>
	<span class="n">win</span><span class="o">-&gt;</span><span class="n">Title</span> <span class="o">=</span> <span class="s">"Hello World"</span><span class="p">;</span>
 
	<span class="n">Application</span><span class="o">^</span> <span class="n">app</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">Application</span><span class="p">();</span>
	<span class="n">app</span><span class="o">-&gt;</span><span class="n">Run</span><span class="p">(</span><span class="n">win</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The output of this program is a blank window with a title “Hello World”. Here Application class is used to start the WPF application, manage the state of application and application level variables and information, but there is no output of it. It is Windows class that is responsible to draw window on the screen. Run method should be the last method call in the program, because this method won’t return until the program close. Return value of Run method is application exit code return to the operating system.</p>

<p>It is not necessary to pass the window object as a parameter in the run function of application class. We can call Run function without any parameter, but if we call the Run function without any parameter then we have to call the Show or ShowDilaog function of Window class before calling the Run. Difference between Show and ShowDialog is Show display the model dialog, on the other hand ShowDialog display the modeless dialog. For our simple application it doesn’t make any difference.</p>

<p>You can inherit your classes from Window and Application classes to store some application specific or window specific information. But remember you class must be inherited using the “ref” keyword and use “gcnew” keyword to create an instance of it on managed heap. Here is a simple program to show the usage of user inherited Window and Application classes.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="cp">#include &lt;windows.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="o">::</span><span class="n">Windows</span><span class="p">;</span>
 
<span class="k">public</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">MyWindow</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Window</span>
<span class="p">{</span>
<span class="nl">public:</span>
	<span class="n">MyWindow</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">Title</span> <span class="o">=</span> <span class="s">"Hello World"</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
 
<span class="k">public</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">MyApplication</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Application</span>
<span class="p">{</span>
<span class="p">};</span>
 
<span class="p">[</span><span class="n">STAThread</span><span class="p">]</span>
<span class="kt">int</span> <span class="n">WINAPI</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span>
				   <span class="n">LPSTR</span> <span class="n">lpCmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">MyWindow</span><span class="o">^</span> <span class="n">win</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">MyWindow</span><span class="p">();</span>
 
	<span class="n">MyApplication</span><span class="o">^</span> <span class="n">app</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">MyApplication</span><span class="p">();</span>
	<span class="n">app</span><span class="o">-&gt;</span><span class="n">Run</span><span class="p">(</span><span class="n">win</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Output of this program is same as the previous one. In this program we can store all the application specific information in MyApplication class and Window specific information in MyWindow class. For example we set the title of the window in the constructor rather than in main after creating the object of it. We can also set other properties of window such as its back ground color, size, etc in the same place i.e. constructor.</p>

<p>These classes and their usages looks quite familiar with MFC. In MFC based application we also need object of two classes named CWinApp and CWnd. Similarly we create only one object of CWinApp based class and call the run method of CWinApp.</p>

<h3 id="23-wpf-class-hierarchy">2.3. WPF Class Hierarchy</h3>

<p>As we have seen before that to make smallest WPF application that display its own window we have to create objects of at least two classes named Window and Application. Before going further let’s take a look at these two classes in little bit more detail. Here is a class diagram to show the inheritance chain for Application and Window class.</p>

<p><img src="https://www.codeguru.com/images/article/16355/Loan_02.gif" alt="img" /></p>

<h3 id="24-high-level-architecture-of-wpf">2.4. High Level Architecture of WPF</h3>

<p>If we see the higher level architecture of WPF then the best approach is to write code in any .Net language weather it is C#, VB or C++ rather than using XAML. If we write code in any programming language then we understand about WPF classes in more detail.</p>

<p>When we write WPF program then it internally uses DirectX to draw everything including all controls. All WPF calls are passed to DirectX via Media Integration Layer. For performance reason Media Integration Layer is written in unmanaged code. Here is an overall diagram of WPF application.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_03.gif" alt="img" /></p>

<p>There are few other layers which are not shown here. Such as taking the input from user is responsibility of user32.dll. In addition WPF is written in .Net based language, it means WPF application uses .Net language and run on common language runtime not shown in this diagram.</p>

<h4 id="241-wpf-layer">2.4.1. WPF Layer</h4>

<p>Now let’s dig down little bit more and try to explore these layers in little bit more detail. First layer in this stack is your application code that is of course a managed code written in any .Net language. In case of Managed C++ it can be a mixture of managed and unmanaged code compiled with /clr switch.</p>

<p>Second layer of the stack is WPF layer. It is composed by three DLLs named WindowsBase.dll, PresentationCore.dll and PresentationFramework.dll. All WPF programs whether written in C++, C# or VB.Net has to include the reference of these DLLs.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_04.gif" alt="img" /></p>

<p>The first component in WPF layer is WindowsBase.DLL. This DLL provides some very basic level functionality to the WPF which can be used in other applications too. This DLL provides the support of threading and dependency property, which we are going to study in more detail in the following sections.</p>

<p>Second component PresentationCore.DLL provides the basic building block for WPF framework. From the design prospect WPF divides its classes in two groups, the core and framework. This DLL has some core functionality of WPF classes such as Visual to draw something and UIElement, basic building block that WPF Framework uses.</p>

<p><code class="language-plaintext highlighter-rouge">PresentationFrameWork</code> provides the support of WPF framework. This DLL has support for layout, event handling, controls, animation and almost everything WPF has. When writing a WPF program, we usually use the classes defined in this component. All the controls such as Label, TextBlock, Button, Menu etc are defined in this component.</p>

<h4 id="242-media-integration-layer">2.4.2. Media Integration Layer</h4>

<p>The other layer of WPF program is Media Integration Layer. It is written in unmanaged code for performance reason and directly interfaces with DirectX. This layer has two important component milcore.dll and windowscodecs.dll. Milcore.dll is responsible for give 2D and 3D support and windowscodecs.dll is support different imaging support.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_05.gif" alt="img" /></p>

<p>Here is a combine diagram to show all the major component of WPF application. This diagram shows all major components of WPF application. Please note that in this diagram we only focus on WPF and DirectX, because WPF internally uses DirectX to draw everything on the screen. But there are other components also involved in any WPF or any windows based program. It still uses User32.dll to get user input and operating system kernel DLL and device driver to hardware interface. In addition it is also understood that WPF code also runs in managed environment. It means WPF layer is based on Common run time environment. To make things simple, we only focus those elements in this diagram, which are part of WPF.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_06.gif" alt="img" /></p>

<h2 id="3-time-value-of-money">3. Time Value of Money</h2>

<p>The time value of money is a very basic concept in financial engineering and lots of other concepts are built on it. Here we study the value of money with respect to time (i.e. how much the value of money would be change from time). The value of money changes either from time or from interest rates. If you assumed that the interest rate is same during the whole time period, then the only factor that can change the value of money is time.</p>

<h3 id="31-compound-interest">3.1. Compound Interest</h3>

<p>Compound interest is the most common method of calculating the interest in real life. The difference between simple interest and compound interest is that in simple interest you will get profit only in the first year’s value of the money; however in compound interest you will get money on every year’s value of the money. For example if you have $1000 and your bank will give you 10% interest rate then after one year the value of your money will become $1100. In case of simple interest you will still get the second year’s profit based on the first year value, $1000. In the case of compound interest, you will get profit on $1100 for the second year.</p>

<p>In compound interest you will get profit on every year’s value not only the first year value therefore the value of money will increase more rapidly in compound interest than simple interest. We show the change of the value of money in ten years in the given table.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_07.gif" alt="img" /></p>

<p>Demonstrating the same thing in the form of graph shows a curve as can be seen in the figure.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_08.gif" alt="img" /></p>

<p>The easiest way to calculate the compound interest is that first convert the interest in one point form then multiplies it with original value.</p>

<p>For example to convert 12.5% into one point form, first divide it by 100 then add one in the result. It will become 1.125. If we multiply the original amount with this then we will get the value of money after one year. To get the value of money after two year, we will multiply the original value with 1.125 twice.</p>

<p>Mathematically we can write this in this way</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_09.gif" alt="img" /></p>

<h3 id="32-period-compound-interest">3.2. Period Compound Interest</h3>

<p>It is not uncommon to get profit more than once per year, such as after every six months, monthly etc. This is known as Periodic Compound Interest. In that case we simply divide the interest rate with the number of times we get profit in the year. For example, if you are getting profit with 10% interest rate annually and you want to get profit after every six months then your interest rate will be 5% not 10% because you are getting profit twice per year.</p>

<p>Let’s take a look this with one example. Suppose you invest $1500 in a bank with 6% interest rate. We have already seen the method to calculate the compound interest annually. Here is the table to show the compound interest calculated annually for 5 years</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_10.gif" alt="img" /></p>

<p>Here is the table to show the interest calculated bi annually.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_11.gif" alt="img" /></p>

<p>This table shows that we will get more profit with monthly than annually. It is even more than bi-annually.</p>

<p>In other words the higher the number of times we get the profit, the higher the profit we get at the end of the year. Here is the mathematical formula to calculate the profit taken more than once.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_12.gif" alt="img" /></p>

<h3 id="33-annuity">3.3. Annuity</h3>

<p>In financial engineering annuity is a concept of taking or giving some predefined money at some specified time, for example if you pay the installment of your car or withdraw some specific money from the bank every month. The important thing about annuity is that the amount should be same and periodic.</p>

<p>Suppose you deposit some money in your bank every year. If you are not getting any profit then after some years the value of your money will be the multiple of the number of year. For example if you deposit $1000 in a bank for 5 years then you will have $5000 after 5 years.</p>

<p>As we know that the value of money changes with respect to time and that change is depend on the interest rate. Let’s suppose we are getting 10% interest rate from the bank. In this case we won’t get any profit at the end of first year, because we deposited that money at the end of year and that money was not in the bank for the whole year. At the end of second year, we will get profit on the first year money because that money was in the bank for whole year and we won’t get any profit of the money which we deposited at the end of second year. Similarly at the end of third year we will get the profit of first two years money because that money was in the bank for the whole year.</p>

<p>In other words we can say that if we deposit “x” amount in a bank for “n” years then we won’t get any profit on the money which we deposit at the last year. We will get only one year profit on the money that we will deposit at “n-1” year because that money will be in the bank for only one year. The money we will deposit at “n-1” year, we will get 2 years profit, because that money will be in the bank for 2 years. In the same way we will get the “n-1” year profit on the first year money because that money will be in the bank for “n-1” years. Now the value of our annuity will be the sum of all of these values. In this table we show the profit on $1000 with 10% interest rate for different 1 year to 5 years.</p>

<p>It means this will be the value of our money after every year.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_13.gif" alt="img" /></p>

<p>If we make a graph of this then it will be a curve.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_14.gif" alt="img" /></p>

<p>Mathematically we can write the same thing this way</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_15.gif" alt="img" /></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_16.gif" alt="img" /></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_17.gif" alt="img" /></p>

<p>This is a geometric series. Using the geometric series formula for sum, it will become something like this.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_18.gif" alt="img" /></p>

<h3 id="34-annuity-with-more-than-one-payment-per-year">3.4. Annuity with more than one payment per year</h3>

<p>In real life most of our payments are monthly, biannually or quarterly basis not on annually basis. In this section we are going to study what will be the effect of this on annuity when we have more than one payment in the year. We have already study the concept of more than one payment during the study of time value of money.</p>

<p>If we have more than one payment per year then we simply divide the interest rate by the number of payments per year because interest rate is usually given in annual interest rate form. In addition we multiply the number of years by the number of payments per year, because now we are getting (or paying) more payments.</p>

<p>We already know how to calculate the future value of annuity when there is only one payment per year. Here is the modified formula to calculate the future value of annuity when there is more than one payment per year.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_19.gif" alt="img" /></p>

<h3 id="35-loan-amortization">3.5. Loan Amortization</h3>

<p>If we take a loan then we usually pay it easily monthly installments. This is in fact application of annuity with more than one payment per year. To calculate the monthly payment of the loan first we have to calculate the present value of the annuity.</p>

<p>We already studied how to calculate future value of money using this formula.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_09.gif" alt="img" /></p>

<p>If we just modify this formula little bit then we can calculate the present value of money. Here is a formula to calculate the present value of the money.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_20.gif" alt="img" /></p>

<p>To calculate the present value of annuity, we have to calculate the present value of all the money we deposit (or withdraw) into a bank and then sum it. Mathematically we can write it in this way.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_21.gif" alt="img" /></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_22.gif" alt="img" /></p>

<p>This is again a geometric series. Here is the sum of this series using geometric series formula.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_23.gif" alt="img" /></p>

<p>If there is more than one payment per year then we have to divide the interest rate by the total number of payments per year and multiply total number of years. Here is a modified formula to calculate the present value of annuity if there is more than one payment per year.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_24.gif" alt="img" /></p>

<p>If we already know the present value of annuity (i.e. amount of loan we are going to take) interest rate and the payment method (i.e. weather it is going to be monthly, quarterly, yearly etc) then we can easily rearrange this formula to calculate the payment amount of the loan. Here is the formula to calculate the payment amount of loan. For monthly payment the value of n should be 12, i.e. 12 payments per year.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_25.gif" alt="img" /></p>

<p>Let’s suppose e get $5000 loan from a bank with 12.5% interest rate. Just to keep our calculation small we assumed that we are going to pay off the loan in one year, so we will have only 12 payments.</p>

<p>By using the above formula our monthly payment would be $445.4143. Now the question is how much money of this payment is going to pay the interest and how much will be used to paid off the principle amount. We can calculate the interest on this money using time value of money formula.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_26.gif" alt="img" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FV = 5052.08333
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The interest after one month will be</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Interest = Future Value - Present Value
Interest = 5052.08333 - 5000
Interest = 52.08333
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The remaining amount of your payment will be the principle amount.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Principle = Payment - Interest
Principle = 455.4143 - 52.08333
Principle = 393.331
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now our new amount will be</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Amount = 5000 - 393.331
Amount = 4606.669202
</pre></td></tr></tbody></table></code></pre></div></div>

<p>And the second month’s interest will be calculated on this new amount. Similarly we can calculate the interest part and principle amount part of each payment for every payment. Here we showed the same thing in tabular form, here 5th and 6th columns shows the interest part and principle amount part of the monthly payment respectively.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_27.gif" alt="img" /></p>

<p>If we take a look at this table carefully then we can observe that the amount of interest rate will decrease after every month. In first month we pay $52.08 interest, in second month it became $47.98, in third month it became $43.84 and in last month we pay only $4.59 interest. This is because the principle amount decrease every month, and we already know that if interest rate and time is constant then the only factor to change the value of interest is original amount. Lower the amount, lower the interest rate is.</p>

<p>On the other hand the amount of principle amount will increase from every previous month. The reason of this phenomenon is very obvious; because the value of monthly payment is same and interest rate decrease every month then the remaining amount will increase every month. In other words, as month goes on, the value of your principle amount will decrease more rapidly.</p>

<p>We can show the same thing in this graph. Here we displayed two graphs; first one shows the interest part of the monthly payment and other shows the principle amount part of the payment.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_28.gif" alt="img" /></p>

<p>This graph shows the value of interest we pay each month to pay off the loan. This graph is strictly decreasing; means the value of interest will decrease every month. It looks like a straight line, but in fact this is a curve. There are twelve payments in this example, but if we have an example of 30 years home mortgage, i.e. 360 payments then we can see this easily.</p>

<p>What is the meaning of curve line instead of straight line? We have already seen that the amount of interest decrease, but the ratio of reduction of interest rate is not same during every month. The ratio of decreasing the interest part will increase in each passing month. It means the interest of interest we pay each month will reduce more rapidly than same every month.</p>

<p>In the above example if we take a difference between the interest part of first two payments then it would be</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Difference
</pre></td></tr></tbody></table></code></pre></div></div>

<p>1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> = 52.08333 - 47.9861Difference
</pre></td></tr></tbody></table></code></pre></div></div>

<p>1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> = 4.097198
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Similarly the difference between the interest part of the second month and third month would be</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Difference
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> = 47.9861 - 43.8462
 Difference
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> = 4.139877
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We can verify that the difference between the interest parts of two consecutive payments will always increase.</p>

<p>The situation of principle amount part is no different. Let’s take a look at the principle amount part of the payment. Here is the graph of principle amount part of the payment.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_29.gif" alt="img" /></p>

<p>This graph is very much similar to the interest rate part of the payment graph. The only difference is the direction. This is also a curve just like the interest part graph but here we can see the amount of principle amount is increasing. The difference between any two consecutive principle amount parts will be exactly same as we have seen in the interest graph, but with a negative sign. Reason behind this is very simple, we have fixed monthly payment every months and it contains only two parts, interest and principle; so whatever value is excluded from one portion will automatically be included into other portion.</p>

<p>For every payment there are two parts of payment the interest part and principle amount part.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>PMT = INTEREST + PRINCIPLE
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We have different value of interest and principle amount in each payment. In general we can represent it in such way</p>

<p>PMT<sub>i</sub> = R<sub>i</sub> + P<sub>i</sub></p>

<p>We already saw that the principle amount will reduce with each payment. It depends on the interest calculated in the previous principle amount. Here is the formula to calculate the remaining principle amount after a specified amount of time, say after “n” months.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_30.gif" alt="img" /></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_31.gif" alt="img" /></p>

<p>This is again a geometric series. We can calculate the sum of it using geometric series formula. The value of Principle amount after nth payment would be</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_32.gif" alt="img" /></p>

<p>Similarly if we want to calculate the interest part of any specific period then first we have to calculate the principle amount remaining at that time and multiply it with interest rate. Here is the formula to calculate the interest part of any specific payment.</p>

<p>R<sub>n</sub> = A<sub>n</sub> * r</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_33.gif" alt="img" /></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_34.gif" alt="img" /></p>

<p>After solving this geometric series we get the formula to calculate the interest part of any particular payment. Here is the formula to calculate the interest part of any payment.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_35.gif" alt="img" /></p>

<p>Once we calculated the interest part then principle amount part is very easy to calculate. Any payment has only two parts principle amount and interest, if we already calculate the interest part then we can subtract it from the payment to get the principle amount part. Here is the formula to calculate the principle amount part of the payment.</p>

<p>PMT<sub>i</sub> = R<sub>i</sub> + P<sub>i</sub></p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_36.gif" alt="img" /></p>

<h2 id="4-loan-amortization-application-in-wpf">4. Loan Amortization Application in WPF</h2>

<p>We have all of our required formulae so we can write small functions to perform these calculations. Here are the auxiliary functions to calculate remaining balance, interest part and principle amount part of any particular payment.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// Calculate the remaining balance at particular payment</span>
<span class="kt">double</span> <span class="n">PaymentWindow</span><span class="o">::</span><span class="n">CalculateBalance</span><span class="p">(</span><span class="kt">int</span> <span class="n">month</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">double</span> <span class="n">interestTerm</span> <span class="o">=</span> <span class="n">Math</span><span class="o">::</span><span class="n">Pow</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">interestRate</span><span class="p">),</span> <span class="n">month</span><span class="p">);</span>
	<span class="kt">double</span> <span class="n">totalInterest</span> <span class="o">=</span> <span class="n">principle</span> <span class="o">*</span> <span class="n">interestTerm</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">totalPaid</span> <span class="o">=</span> <span class="n">payment</span> <span class="o">*</span> <span class="p">(</span><span class="n">interestTerm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">interestRate</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">totalInterest</span> <span class="o">-</span> <span class="n">totalPaid</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="c1">// Calculate the Interest part of any particular payment</span>
<span class="kt">double</span> <span class="n">PaymentWindow</span><span class="o">::</span><span class="n">CalculateInterestPart</span><span class="p">(</span><span class="kt">int</span> <span class="n">month</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">double</span> <span class="n">interestTerm</span> <span class="o">=</span> <span class="n">Math</span><span class="o">::</span><span class="n">Pow</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">interestRate</span><span class="p">),</span> <span class="p">(</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
	<span class="kt">double</span> <span class="n">totalInterest</span> <span class="o">=</span> <span class="n">principle</span> <span class="o">*</span> <span class="n">interestTerm</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">totalPaid</span> <span class="o">=</span> <span class="n">payment</span> <span class="o">*</span> <span class="p">(</span><span class="n">interestTerm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">interestRate</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">totalInterest</span> <span class="o">-</span> <span class="n">totalPaid</span><span class="p">)</span> <span class="o">*</span> <span class="n">interestRate</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="c1">// Calculate the principle part of any particular payment</span>
<span class="kt">double</span> <span class="n">PaymentWindow</span><span class="o">::</span><span class="n">CalculatePrinciple</span><span class="p">(</span><span class="kt">int</span> <span class="n">month</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">payment</span> <span class="o">-</span> <span class="n">CalculateInterestPart</span><span class="p">(</span><span class="n">month</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We need to take four inputs such as total payment, interest rate, total number of payment per year, total number of years and type of payments. We need auxiliary class to store information about all payments and export these as properties so we can use this in list control. Here is our auxiliary class.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">PaymentInfo</span>
<span class="p">{</span>
<span class="nl">private:</span>
	<span class="kt">int</span> <span class="n">paymentNo</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">payment</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">principle</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">interest</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">balance</span><span class="p">;</span>
 
<span class="nl">public:</span>
	<span class="n">property</span> <span class="kt">int</span> <span class="n">PaymentNo</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">get</span><span class="p">()</span>
		<span class="p">{</span> <span class="k">return</span> <span class="n">paymentNo</span><span class="p">;</span> <span class="p">}</span>
 
		<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
		<span class="p">{</span> <span class="n">paymentNo</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">}</span>
 
	<span class="n">property</span> <span class="kt">double</span> <span class="n">Payment</span>
	<span class="p">{</span>
		<span class="kt">double</span> <span class="n">get</span><span class="p">()</span>
		<span class="p">{</span> <span class="k">return</span> <span class="n">payment</span><span class="p">;</span> <span class="p">}</span>
 
		<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span>
		<span class="p">{</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">}</span>
 
	<span class="n">property</span> <span class="kt">double</span> <span class="n">Principle</span>
	<span class="p">{</span>
		<span class="kt">double</span> <span class="n">get</span><span class="p">()</span>
		<span class="p">{</span> <span class="k">return</span> <span class="n">principle</span><span class="p">;</span>	<span class="p">}</span>
 
		<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span>
		<span class="p">{</span> <span class="n">principle</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">}</span>
 
	<span class="n">property</span> <span class="kt">double</span> <span class="n">Interest</span>
	<span class="p">{</span>
		<span class="kt">double</span> <span class="n">get</span><span class="p">()</span>
		<span class="p">{</span> <span class="k">return</span> <span class="n">interest</span><span class="p">;</span> <span class="p">}</span>
 
		<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span>
		<span class="p">{</span> <span class="n">interest</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>	<span class="p">}</span>
	<span class="p">}</span>
 
	<span class="n">property</span> <span class="kt">double</span> <span class="n">Balance</span>
	<span class="p">{</span>
		<span class="kt">double</span> <span class="n">get</span><span class="p">()</span>
		<span class="p">{</span> <span class="k">return</span> <span class="n">balance</span><span class="p">;</span> <span class="p">}</span>
 
		<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span>
		<span class="p">{</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Here is an auxiliary function to calculate the interest part, principle amount part and remaining balance after each payment and add those items in the list control.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// Calculate the complete amortization schedule and fill the list control</span>
<span class="kt">void</span> <span class="n">PaymentWindow</span><span class="o">::</span><span class="n">CalculatePayment</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Title</span> <span class="o">=</span> <span class="s">L"Amortizatin Schedule for "</span> <span class="o">+</span> <span class="n">Convert</span><span class="o">::</span><span class="n">ToString</span><span class="p">(</span><span class="n">totalpayments</span><span class="p">)</span> <span class="o">+</span> <span class="s">" Payments"</span><span class="p">;</span>
 
	<span class="c1">// calculate interest term</span>
	<span class="kt">double</span> <span class="n">interestTerm</span> <span class="o">=</span> <span class="n">Math</span><span class="o">::</span><span class="n">Pow</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">interestRate</span><span class="p">),</span> <span class="n">totalpayments</span><span class="p">);</span>
 
	<span class="c1">// calculate payment</span>
	<span class="n">payment</span> <span class="o">=</span> <span class="p">(</span><span class="n">principle</span> <span class="o">*</span> <span class="n">interestRate</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">interestTerm</span><span class="p">));</span>
 
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">iIndex</span> <span class="o">&lt;=</span> <span class="n">totalpayments</span><span class="p">;</span> <span class="o">++</span><span class="n">iIndex</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">PaymentInfo</span><span class="o">^</span> <span class="n">paymentInfo</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">PaymentInfo</span><span class="p">();</span>
		<span class="n">paymentInfo</span><span class="o">-&gt;</span><span class="n">PaymentNo</span> <span class="o">=</span> <span class="n">iIndex</span><span class="p">;</span>
		<span class="n">paymentInfo</span><span class="o">-&gt;</span><span class="n">Balance</span> <span class="o">=</span> <span class="n">CalculateBalance</span><span class="p">(</span><span class="n">iIndex</span><span class="p">);</span>
		<span class="n">paymentInfo</span><span class="o">-&gt;</span><span class="n">Payment</span> <span class="o">=</span> <span class="n">payment</span><span class="p">;</span>
		<span class="n">paymentInfo</span><span class="o">-&gt;</span><span class="n">Interest</span> <span class="o">=</span> <span class="n">CalculateInterestPart</span><span class="p">(</span><span class="n">iIndex</span><span class="p">);</span>
		<span class="n">paymentInfo</span><span class="o">-&gt;</span><span class="n">Principle</span> <span class="o">=</span> <span class="n">CalculatePrinciple</span><span class="p">(</span><span class="n">iIndex</span><span class="p">);</span>
 
		<span class="n">lstView</span><span class="o">-&gt;</span><span class="n">Items</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">paymentInfo</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Here is the output of the program.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_37.gif" alt="img" /></p>

<p>This program is not restricted to monthly payments only. We can select different payment methods such as Monthly, Quarterly, Bi-Yearly, Yearly or daily. There is one enum defined for the payment selection.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">enum</span> <span class="n">PaymentMethod</span>
<span class="p">{</span>
	<span class="n">NotSelected</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">Monthly</span><span class="p">,</span>
	<span class="n">Quartly</span><span class="p">,</span>
	<span class="n">BiYearly</span><span class="p">,</span>
	<span class="n">Yearly</span><span class="p">,</span>
	<span class="n">Daily</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Here is the output of the amortization schedule. This dialog display the monthly payment, the total amount paid over time and the interest and principle amount part of every payment.</p>

<p><img src="http://www.codeguru.com/images/article/16355/loan_38.gif" alt="img" /></p>

<p><br /></p>

<p><strong>Reference:</strong>
<a rel="nofollow noopener noreferrer" target="_blank" href="https://www.codeguru.com/cpp/cpp/cpp_managed/general/article.php/c16355/Using-WPF-with-Managed-C.htm">https://www.codeguru.com/cpp/cpp/cpp_managed/general/article.php/c16355/Using-WPF-with-Managed-C.htm</a></p>


            <style>
.PageNav {
  font-size: 14px;
  display: block;
  width: auto;
  overflow: hidden;
}

.PageNav a {
  display: block;
  width: 50%;
  float: left;
  margin: 1em 0;
}

.PageNav .next {
  text-align: right;
}    
</style>

<div style="margin-top:2em; padding:0 1.5em; border:1px solid #d3d3d3; background-color:#deebf7">
    <h3>版权声明</h3>
    <ul>
        <li>本文作者：<a href="http://localhost:4000" target="_blank">极客玩家大白</a></li>
        <li>本文链接：<a href="http://localhost:4000/Using-WPF-with-Managed-cpp.html" target="_blank">http://localhost:4000/Using-WPF-with-Managed-cpp.html</a></li>
        <li>郑重声明：本文为博主原创或经授权转载的文章，欢迎转载，但<b>转载文章之后必须在文章页面明显位置注明出处</b>，否则保留追究法律责任的权利。如您有任何疑问或者授权方面的协商，请留言。</li>
    </ul>
</div>

<div class="PageNav">
    
    <a class="prev" href="/aimed-at-offer-search-in-two-dimensional-array.html"><i class="fa fa-arrow-left"></i>&nbsp;剑指Offer | 二维数组中的查找</a>
    
    
    <a class="next" href="/wpf-data-binding-debug-guide.html"> WPF中的Data Binding调试指南&nbsp;<i class="fa fa-arrow-right"></i></a>
    
</div>

<div>
    <p align="center">
        
        <img src="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/images/dotnet.jpg" width="300" height="300">
        
        <br />
        一个有故事的程序员
    </p>
    <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
        <strong>（转载本站文章请注明作者和出处 <a href="//geekplayers.com">极客玩家大白</a>）</strong>
    </p>
    <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
        <strong><a href="//geekplayers.com" target="_blank">点击了解 ：.NET技术人的网站</a></strong>
    </p>
</div>

            <!-- Comments -->
            <div class="comment">
             

  
    <a href="#" class="show_disqus_comment" onclick="return false;">Show Disqus Comments</a>
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
        this.page.url = 'http://localhost:4000/Using-WPF-with-Managed-cpp.html';
        this.page.identifier = '/Using-WPF-with-Managed-cpp.html';
        this.page.title = '基于托管的C++来使用WPF - Using WPF with Managed C++';
    };
    var disqus_loaded = false;
    $(function() {
        $('.show_disqus_comment').on('click', function() { // DON'T EDIT BELOW THIS LINE
            $(this).html('加载中...');
            var that = this;
            if (!disqus_loaded) {
                var d = document, s = d.createElement('script');

                s.type = 'text/javascript';
                s.async = true;
                var shortname = 'yanglr';

                s.src = '//' + shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);

                disqus_loaded = true;
            }
            $(that).remove();
        })
    })
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  

  
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/css/gitalk.css"> <!-- 根据 cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css 微调 -->
        <script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
        <script>
        var title = location.pathname.substr(0, 50); //截取路径的前50个字符作为标识符          
        var gitalk = new Gitalk({
            id: title,
            clientID: '22eb6462c987e7a79860',
            clientSecret: '6cd15fa90d4e2f73fa16eaab9b3f783831fe3f3d',
            repo: 'geekplayers.com',
            owner: 'yanglr',
            admin: ['yanglr'],
            labels: ['gitalk'],
            perPage: 50
        })
        gitalk.render('gitalk-container');
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>

</article>

<script type="text/javascript">
    const headings = document.querySelectorAll('h2,h3,h4'); // 1
    const linkContent = '<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'; // 2
    for (const heading of headings) { // 3
        const linkIcon = document.createElement('a'); // 4
        
        if(heading.id != '')
        {
            linkIcon.setAttribute('href', `#${heading.id}`); // 5
            linkIcon.innerHTML = linkContent; // 6
            heading.firstChild.textContent = ' ' + heading.firstChild.textContent;
            heading.insertBefore(linkIcon, heading.firstChild);; // 7
        }
    }
</script>
        </div>

    
    <footer class="container">
        <div class="site-footer">
            <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/legege007">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/540071991">
               微博
            </a>
            <a target="_blank" href="https://github.com/yanglr">
                GitHub
            </a>
        </div> -->
            <div class="card text-center">
                <ul class="list-inline" style="margin-left: 0;">
                    <li>
                        <a target="_blank" href="https://github.com/yanglr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/legege007">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a target="_blank" href="https://weibo.com/540071991">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="site-footer-links mobile-hidden">
                
                <a href="/docker.html" title="Docker" target="_blank">Docker</a>
                
                <a href="/open-source.html" title="Code" target="_blank">Code</a>
                
                <a href="/geektime.html" title="极客" target="_blank">极客</a>
                
            </div>
            <!--         <div class="site-footer-icons">
                   沪ICP备20019934号-2
            </div> -->
            <div class="scrolltop">
                粤ICP备12009483号（Gitee站）
                <a href="javascript:window.scrollTo(0,0)">TOP↑</a>
            </div>
            <div class="rss">
                <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
                Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
            </div>
        </div>
        <!-- Third-Party JS -->
        <script type="text/javascript" src="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/bower_components/geopattern/js/geopattern.min.js"></script>
        <!-- My JS -->
        <script type="text/javascript" src="//cdn.jsdelivr.net/gh/yanglr/yanglr.github.io/assets/js/script.js"></script>
        

        <!-- Cnzz Analytics -->
        <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279049771'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279049771%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <!-- Cnzz Analytics -->
    </footer>


    </body>

</html>
