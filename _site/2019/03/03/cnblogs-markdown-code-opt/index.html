<p>博客园的markdown模式下的代码高亮功能使用的是<code class="highlighter-rouge">highlight.js</code>，没有行号和显示相应编程语言的功能，只好自己将其改造了一下(将这两种功能一并实现了)~</p>

<p>先看一下效果，再详细介绍方法~
<img src="http://geekplayers.com/assets/images/2019/blog/cnblogs-highlight.png" alt="cnblogs-大白技术控" /></p>

<h2 id="查看博客园markdown所使用的代码高亮插件">查看博客园markdown所使用的代码高亮插件</h2>
<p>先找到一篇markdown模式下写的文章，然后打开Chrome，依次使用 F12 -&gt; network -&gt; filter “.js”，可知 代码高亮插件是 <a href="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js">highlight.js</a>.
同理可知TinyMCE模式下使用的是<a href="https://github.com/syntaxhighlighter/syntaxhighlighter/wiki/Usage">SyntaxHighlighter</a>插件.
尝试了很多方法，最后选择了开源的插件 <a href="https://github.com/wcoder/highlightjs-line-numbers.js">highlightjs-line-numbers.js</a>，其原理是生成一个新的<code class="highlighter-rouge">table</code>，增加<code class="highlighter-rouge">tr</code>、 <code class="highlighter-rouge">td</code>标签, 并设置<code class="highlighter-rouge">border</code>为<code class="highlighter-rouge">none</code>。</p>

<p>该插件官方文档中提到的方法为:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.6.0/dist/highlightjs-line-numbers.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="nx">hljs</span><span class="p">.</span><span class="nx">initHighlightingOnLoad</span><span class="p">();</span>
<span class="nx">hljs</span><span class="p">.</span><span class="nx">initLineNumbersOnLoad</span><span class="p">();</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="调整markdown的相关css">调整markdown的相关css</h2>
<p>接着按需要改进一下markdown的样式，将下面内容贴到<code class="highlighter-rouge">页面定制css</code>一栏即可。</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nc">.cnblogs-markdown</span> <span class="nc">.hljs</span> <span class="p">{</span>
   <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>


<span class="nf">#cnblogs_post_body</span> <span class="nt">th</span><span class="o">,</span> <span class="nf">#cnblogs_post_body</span> <span class="nt">td</span><span class="o">,</span> <span class="nc">.cnblogs-post-body</span> <span class="nt">th</span><span class="o">,</span> <span class="nc">.cnblogs-post-body</span> <span class="nt">td</span> <span class="p">{</span>
   <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span> <span class="cp">!important</span><span class="p">;</span>
   <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.postCon</span> <span class="p">{</span>
   <span class="nl">font-size</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.cnblogs-markdown</span> <span class="nc">.hljs</span><span class="o">,</span> <span class="nc">.cnblogs-post-body</span> <span class="nc">.hljs</span> <span class="p">{</span>
   <span class="nl">font-family</span><span class="p">:</span> <span class="s1">"Consolas"</span><span class="p">,</span><span class="nb">sans-serif</span> <span class="cp">!important</span><span class="p">;</span>
   <span class="nl">font-size</span><span class="p">:</span> <span class="m">15px</span><span class="err">!</span> <span class="n">important</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.cnblogs-markdown</span> <span class="nc">.hljs</span><span class="o">,</span> <span class="nc">.cnblogs-post-body</span> <span class="nc">.hljs</span> <span class="p">{</span>
   <span class="nl">font-family</span><span class="p">:</span> <span class="s1">"Courier New"</span><span class="p">,</span><span class="nb">sans-serif</span><span class="cp">!important</span><span class="p">;</span>
   <span class="nl">font-size</span><span class="p">:</span> <span class="m">15px</span><span class="cp">!important</span><span class="p">;</span>
   <span class="nl">line-height</span><span class="p">:</span> <span class="m">1.5</span><span class="cp">!important</span><span class="p">;</span>
   <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#cnblogs_post_body</span> <span class="nt">table</span><span class="o">,</span> <span class="nc">.cnblogs-post-body</span> <span class="nt">table</span> <span class="p">{</span>
   <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span> <span class="cp">!important</span><span class="p">;</span>
   <span class="nl">border-collapse</span><span class="p">:</span> <span class="nb">collapse</span><span class="p">;</span>
   <span class="nl">word-break</span><span class="p">:</span> <span class="n">break-word</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="实现加代码行号显示代码所用语言的具体js代码">实现加代码行号、显示代码所用语言的具体<code class="highlighter-rouge">js</code>代码</h2>
<p>然后在页脚HTML中加入如下<code class="highlighter-rouge">js</code>代码~</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">".cnblogs-post-body pre &gt; code"</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">setCodeRowWithLang</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">".cnblogs-post-body pre"</span><span class="p">));</span>
    <span class="k">else</span> <span class="nx">setCodeRowWithLang</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">".cnblogs-markdown pre"</span><span class="p">));</span>

    <span class="cm">/* markdown模式下为代码加入行号, 调用插件highlightjs-line-numbers.js */</span>
    <span class="nx">hljs</span><span class="p">.</span><span class="nx">initHighlightingOnLoad</span><span class="p">();</span>
    <span class="nx">hljs</span><span class="p">.</span><span class="nx">initLineNumbersOnLoad</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">setCodeRowWithLang</span><span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* var pre = $(".cnblogs-post-body pre");  选中需要处理的代码块, 如果不是首页，选择器为 .cnblogs-markdown pre  */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pre</span> <span class="o">&amp;&amp;</span> <span class="nx">pre</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pre</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">lang</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span><span class="p">;</span>  <span class="cm">/*  获取高亮的语言，得到js/html/cpp等全小写的语言名，下面进行一个转换  */</span>
            <span class="kd">var</span> <span class="nx">langMap</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"html"</span><span class="p">:</span> <span class="s2">"HTML"</span><span class="p">,</span>
                <span class="s2">"xml"</span><span class="p">:</span> <span class="s2">"XML"</span><span class="p">,</span>
                <span class="s2">"svg"</span><span class="p">:</span> <span class="s2">"SVG"</span><span class="p">,</span>
                <span class="s2">"mathml"</span><span class="p">:</span> <span class="s2">"MathML"</span><span class="p">,</span>
                <span class="s2">"css"</span><span class="p">:</span> <span class="s2">"CSS"</span><span class="p">,</span>
                <span class="s2">"clike"</span><span class="p">:</span> <span class="s2">"C-like"</span><span class="p">,</span>
                <span class="s2">"js"</span><span class="p">:</span> <span class="s2">"JavaScript"</span><span class="p">,</span>
                <span class="s2">"abap"</span><span class="p">:</span> <span class="s2">"ABAP"</span><span class="p">,</span>
                <span class="s2">"apacheconf"</span><span class="p">:</span> <span class="s2">"Apache Configuration"</span><span class="p">,</span>
                <span class="s2">"apl"</span><span class="p">:</span> <span class="s2">"APL"</span><span class="p">,</span>
                <span class="s2">"arff"</span><span class="p">:</span> <span class="s2">"ARFF"</span><span class="p">,</span>
                <span class="s2">"asciidoc"</span><span class="p">:</span> <span class="s2">"AsciiDoc"</span><span class="p">,</span>
                <span class="s2">"adoc"</span><span class="p">:</span> <span class="s2">"AsciiDoc"</span><span class="p">,</span>
                <span class="s2">"asm6502"</span><span class="p">:</span> <span class="s2">"6502 Assembly"</span><span class="p">,</span>
                <span class="s2">"aspnet"</span><span class="p">:</span> <span class="s2">"ASP.NET (C#)"</span><span class="p">,</span>
                <span class="s2">"autohotkey"</span><span class="p">:</span> <span class="s2">"AutoHotkey"</span><span class="p">,</span>
                <span class="s2">"autoit"</span><span class="p">:</span> <span class="s2">"AutoIt"</span><span class="p">,</span>
                <span class="s2">"shell"</span><span class="p">:</span> <span class="s2">"Bash"</span><span class="p">,</span>
                <span class="s2">"basic"</span><span class="p">:</span> <span class="s2">"BASIC"</span><span class="p">,</span>
                <span class="s2">"csharp"</span><span class="p">:</span> <span class="s2">"C#"</span><span class="p">,</span>
                <span class="s2">"dotnet"</span><span class="p">:</span> <span class="s2">"C#"</span><span class="p">,</span>
                <span class="s2">"cpp"</span><span class="p">:</span> <span class="s2">"C++"</span><span class="p">,</span>
                <span class="s2">"cil"</span><span class="p">:</span> <span class="s2">"CIL"</span><span class="p">,</span>
                <span class="s2">"csp"</span><span class="p">:</span> <span class="s2">"Content-Security-Policy"</span><span class="p">,</span>
                <span class="s2">"css-extras"</span><span class="p">:</span> <span class="s2">"CSS Extras"</span><span class="p">,</span>
                <span class="s2">"django"</span><span class="p">:</span> <span class="s2">"Django/Jinja2"</span><span class="p">,</span>
                <span class="s2">"jinja2"</span><span class="p">:</span> <span class="s2">"Django/Jinja2"</span><span class="p">,</span>
                <span class="s2">"dockerfile"</span><span class="p">:</span> <span class="s2">"Docker"</span><span class="p">,</span>
                <span class="s2">"erb"</span><span class="p">:</span> <span class="s2">"ERB"</span><span class="p">,</span>
                <span class="s2">"fsharp"</span><span class="p">:</span> <span class="s2">"F#"</span><span class="p">,</span>
                <span class="s2">"gcode"</span><span class="p">:</span> <span class="s2">"G-code"</span><span class="p">,</span>
                <span class="s2">"gedcom"</span><span class="p">:</span> <span class="s2">"GEDCOM"</span><span class="p">,</span>
                <span class="s2">"glsl"</span><span class="p">:</span> <span class="s2">"GLSL"</span><span class="p">,</span>
                <span class="s2">"gml"</span><span class="p">:</span> <span class="s2">"GameMaker Language"</span><span class="p">,</span>
                <span class="s2">"gamemakerlanguage"</span><span class="p">:</span> <span class="s2">"GameMaker Language"</span><span class="p">,</span>
                <span class="s2">"graphql"</span><span class="p">:</span> <span class="s2">"GraphQL"</span><span class="p">,</span>
                <span class="s2">"hcl"</span><span class="p">:</span> <span class="s2">"HCL"</span><span class="p">,</span>
                <span class="s2">"http"</span><span class="p">:</span> <span class="s2">"HTTP"</span><span class="p">,</span>
                <span class="s2">"hpkp"</span><span class="p">:</span> <span class="s2">"HTTP Public-Key-Pins"</span><span class="p">,</span>
                <span class="s2">"hsts"</span><span class="p">:</span> <span class="s2">"HTTP Strict-Transport-Security"</span><span class="p">,</span>
                <span class="s2">"ichigojam"</span><span class="p">:</span> <span class="s2">"IchigoJam"</span><span class="p">,</span>
                <span class="s2">"inform7"</span><span class="p">:</span> <span class="s2">"Inform 7"</span><span class="p">,</span>
                <span class="s2">"javastacktrace"</span><span class="p">:</span> <span class="s2">"Java stack trace"</span><span class="p">,</span>
                <span class="s2">"json"</span><span class="p">:</span> <span class="s2">"JSON"</span><span class="p">,</span>
                <span class="s2">"jsonp"</span><span class="p">:</span> <span class="s2">"JSONP"</span><span class="p">,</span>
                <span class="s2">"latex"</span><span class="p">:</span> <span class="s2">"LaTeX"</span><span class="p">,</span>
                <span class="s2">"emacs"</span><span class="p">:</span> <span class="s2">"Lisp"</span><span class="p">,</span>
                <span class="s2">"elisp"</span><span class="p">:</span> <span class="s2">"Lisp"</span><span class="p">,</span>
                <span class="s2">"emacs-lisp"</span><span class="p">:</span> <span class="s2">"Lisp"</span><span class="p">,</span>
                <span class="s2">"lolcode"</span><span class="p">:</span> <span class="s2">"LOLCODE"</span><span class="p">,</span>
                <span class="s2">"markup-templating"</span><span class="p">:</span> <span class="s2">"Markup templating"</span><span class="p">,</span>
                <span class="s2">"matlab"</span><span class="p">:</span> <span class="s2">"MATLAB"</span><span class="p">,</span>
                <span class="s2">"mel"</span><span class="p">:</span> <span class="s2">"MEL"</span><span class="p">,</span>
                <span class="s2">"n1ql"</span><span class="p">:</span> <span class="s2">"N1QL"</span><span class="p">,</span>
                <span class="s2">"n4js"</span><span class="p">:</span> <span class="s2">"N4JS"</span><span class="p">,</span>
                <span class="s2">"n4jsd"</span><span class="p">:</span> <span class="s2">"N4JS"</span><span class="p">,</span>
                <span class="s2">"nand2tetris-hdl"</span><span class="p">:</span> <span class="s2">"Nand To Tetris HDL"</span><span class="p">,</span>
                <span class="s2">"nasm"</span><span class="p">:</span> <span class="s2">"NASM"</span><span class="p">,</span>
                <span class="s2">"nginx"</span><span class="p">:</span> <span class="s2">"nginx"</span><span class="p">,</span>
                <span class="s2">"nsis"</span><span class="p">:</span> <span class="s2">"NSIS"</span><span class="p">,</span>
                <span class="s2">"objectivec"</span><span class="p">:</span> <span class="s2">"Objective-C"</span><span class="p">,</span>
                <span class="s2">"ocaml"</span><span class="p">:</span> <span class="s2">"OCaml"</span><span class="p">,</span>
                <span class="s2">"opencl"</span><span class="p">:</span> <span class="s2">"OpenCL"</span><span class="p">,</span>
                <span class="s2">"parigp"</span><span class="p">:</span> <span class="s2">"PARI/GP"</span><span class="p">,</span>
                <span class="s2">"objectpascal"</span><span class="p">:</span> <span class="s2">"Object Pascal"</span><span class="p">,</span>
                <span class="s2">"php"</span><span class="p">:</span> <span class="s2">"PHP"</span><span class="p">,</span>
                <span class="s2">"php-extras"</span><span class="p">:</span> <span class="s2">"PHP Extras"</span><span class="p">,</span>
                <span class="s2">"plsql"</span><span class="p">:</span> <span class="s2">"PL/SQL"</span><span class="p">,</span>
                <span class="s2">"powershell"</span><span class="p">:</span> <span class="s2">"PowerShell"</span><span class="p">,</span>
                <span class="s2">"properties"</span><span class="p">:</span> <span class="s2">".properties"</span><span class="p">,</span>
                <span class="s2">"protobuf"</span><span class="p">:</span> <span class="s2">"Protocol Buffers"</span><span class="p">,</span>
                <span class="s2">"q"</span><span class="p">:</span> <span class="s2">"Q (kdb+ database)"</span><span class="p">,</span>
                <span class="s2">"jsx"</span><span class="p">:</span> <span class="s2">"React JSX"</span><span class="p">,</span>
                <span class="s2">"tsx"</span><span class="p">:</span> <span class="s2">"React TSX"</span><span class="p">,</span>
                <span class="s2">"renpy"</span><span class="p">:</span> <span class="s2">"Ren'py"</span><span class="p">,</span>
                <span class="s2">"rest"</span><span class="p">:</span> <span class="s2">"reST (reStructuredText)"</span><span class="p">,</span>
                <span class="s2">"sas"</span><span class="p">:</span> <span class="s2">"SAS"</span><span class="p">,</span>
                <span class="s2">"sass"</span><span class="p">:</span> <span class="s2">"Sass (Sass)"</span><span class="p">,</span>
                <span class="s2">"scss"</span><span class="p">:</span> <span class="s2">"Sass (Scss)"</span><span class="p">,</span>
                <span class="s2">"sql"</span><span class="p">:</span> <span class="s2">"SQL"</span><span class="p">,</span>
                <span class="s2">"soy"</span><span class="p">:</span> <span class="s2">"Soy (Closure Template)"</span><span class="p">,</span>
                <span class="s2">"tap"</span><span class="p">:</span> <span class="s2">"TAP"</span><span class="p">,</span>
                <span class="s2">"toml"</span><span class="p">:</span> <span class="s2">"TOML"</span><span class="p">,</span>
                <span class="s2">"tt2"</span><span class="p">:</span> <span class="s2">"Template Toolkit 2"</span><span class="p">,</span>
                <span class="s2">"ts"</span><span class="p">:</span> <span class="s2">"TypeScript"</span><span class="p">,</span>
                <span class="s2">"vbnet"</span><span class="p">:</span> <span class="s2">"VB.Net"</span><span class="p">,</span>
                <span class="s2">"vhdl"</span><span class="p">:</span> <span class="s2">"VHDL"</span><span class="p">,</span>
                <span class="s2">"vim"</span><span class="p">:</span> <span class="s2">"vim"</span><span class="p">,</span>
                <span class="s2">"visual-basic"</span><span class="p">:</span> <span class="s2">"Visual Basic"</span><span class="p">,</span>
                <span class="s2">"vb"</span><span class="p">:</span> <span class="s2">"Visual Basic"</span><span class="p">,</span>
                <span class="s2">"wasm"</span><span class="p">:</span> <span class="s2">"WebAssembly"</span><span class="p">,</span>
                <span class="s2">"wiki"</span><span class="p">:</span> <span class="s2">"Wiki markup"</span><span class="p">,</span>
                <span class="s2">"xeoracube"</span><span class="p">:</span> <span class="s2">"XeoraCube"</span><span class="p">,</span>
                <span class="s2">"xojo"</span><span class="p">:</span> <span class="s2">"Xojo (REALbasic)"</span><span class="p">,</span>
                <span class="s2">"xquery"</span><span class="p">:</span> <span class="s2">"XQuery"</span><span class="p">,</span>
                <span class="s2">"yaml"</span><span class="p">:</span> <span class="s2">"YAML"</span>
            <span class="p">};</span>

            <span class="kd">var</span> <span class="nx">displayLangText</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span> <span class="k">in</span> <span class="nx">langMap</span><span class="p">)</span> <span class="nx">displayLangText</span> <span class="o">=</span> <span class="nx">langMap</span><span class="p">[</span><span class="nx">lang</span><span class="p">];</span>
            <span class="k">else</span> <span class="nx">displayLangText</span> <span class="o">=</span> <span class="nx">lang</span><span class="p">;</span>
            <span class="nx">item</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.hljs'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">prepend</span><span class="p">(</span>
                    <span class="s1">'&lt;div align="right" top="0px" right="10px" position="relative"&gt;&lt;a href="javascript:void(0);"&gt;&lt;/a&gt; &lt;font class="codeLang"  title="当前Code所用语言"&gt;'</span> <span class="o">+</span>
                    <span class="nx">displayLangText</span> <span class="o">+</span>
                    <span class="s1">'&lt;/font&gt;&lt;/div&gt;'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>使用 <code class="highlighter-rouge">highlight-line-number.js</code>的前提是已经include进来<code class="highlighter-rouge">highlight.js</code>，虽然首页是默认不load <code class="highlighter-rouge">highlight.js</code>的，但可使用<code class="highlighter-rouge">JQuery</code>的<code class="highlighter-rouge">getScript</code>函数去加载之。</p>

<p>上述<code class="highlighter-rouge">js</code>函数<code class="highlighter-rouge">setCodeRowWithLang()</code>对文章内容和博客首页都是有效的~</p>

<p>本文<strong>首发</strong>于 本人<strong>博客园</strong>博客: <br />
<a href="https://www.cnblogs.com/enjoy233/p/10410089.html">https://www.cnblogs.com/enjoy233/p/10410089.html</a> .</p>

